## What ‚ÄúDuolingo-style streak logic‚Äù actually means

Before writing logic, we lock the **behavioral rules**, not just code.

A Duolingo streak is **not**:

* ‚ÄúAny activity at all‚Äù
* ‚ÄúAll habits completed‚Äù

A Duolingo streak **is**:

* A daily minimum threshold
* Binary pass or fail per day
* Consecutive successful days
* One miss breaks the streak (unless a freeze is used)

We will implement **that exact mental model** in Obsidian.

---

## Canonical streak rule (you can tune later)

We will define:

* **Daily success condition**
  A day counts as successful if **at least 4 out of 6 habits** are completed.

This mirrors Duolingo‚Äôs ‚Äúminimum XP‚Äù rule.

You can change `4` to `3` or `5` later.

---

## REQUIRED daily note structure (non-negotiable)

Each daily note in `Daily/` must look like this:

```markdown
---
type: daily
date: 2025-01-08
---

## Habits

- [ ] üíß Drinking Water
- [ ] üôè Praying
- [ ] üíä Medicine
- [ ] üèÉ Exercise
- [ ] üìñ Reading
- [ ] üßò Meditation
```

No extra tasks inside `## Habits`.

---

## Core concept: ‚ÄúStreak-eligible day‚Äù

We will compute, per day:

```
completed_count = number of completed habit tasks
is_success = completed_count >= 4
```

Everything flows from this.

---

# PART 1: Mark streak-eligible days (Dataview)

This table is not for display.
It is your **debug truth table**.

```dataview
TABLE
  date,
  length(filter(file.tasks, (t) => t.completed)) AS "Completed",
  choice(
    length(filter(file.tasks, (t) => t.completed)) >= 4,
    "‚úÖ Streak Day",
    "‚ùå Broken"
  ) AS "Status"
FROM "Daily"
WHERE type = "daily"
SORT date DESC
```

Run this once.
If this looks right, everything else will work.

---

# PART 2: Current streak (Duolingo logic)

**Definition**
Count consecutive streak-eligible days **ending today**.

If today fails, streak = 0.

```dataview
LET days = reverse(sort(
  filter(
    dv.pages('"Daily"'),
    (p) => p.type = "daily"
  ),
  (p) => p.date
))

LET streak = 0

FOR d IN days {
  IF length(filter(d.file.tasks, (t) => t.completed)) >= 4 {
    streak = streak + 1
  } ELSE {
    BREAK
  }
}

RETURN streak
```

This behaves exactly like Duolingo:

* Miss today ‚Üí streak resets
* Miss yesterday ‚Üí streak is 0
* Continuous wins ‚Üí streak climbs

---

# PART 3: Longest streak (lifetime)

Duolingo always shows this.

```dataview
LET days = sort(
  filter(
    dv.pages('"Daily"'),
    (p) => p.type = "daily"
  ),
  (p) => p.date
)

LET current = 0
LET longest = 0

FOR d IN days {
  IF length(filter(d.file.tasks, (t) => t.completed)) >= 4 {
    current = current + 1
    longest = max(longest, current)
  } ELSE {
    current = 0
  }
}

RETURN longest
```

This never resets unless you delete history.

---

# PART 4: Streak health donut (Tracker)

This feeds your **Duolingo-style ring**.

```tracker
searchType: dvField
searchTarget: streakHealth
folder: "Daily"
chartType: donut
title: Streak Health
dataset:
  - label: Streak Days
    query: >
      length(
        filter(
          dv.pages('"Daily"'),
          (p) =>
            length(filter(p.file.tasks, (t) => t.completed)) >= 4
        )
      )
  - label: Missed Days
    query: >
      length(dv.pages('"Daily"')) -
      length(
        filter(
          dv.pages('"Daily"'),
          (p) =>
            length(filter(p.file.tasks, (t) => t.completed)) >= 4
        )
      )
color:
  - "#22C55E"
  - "#E5E7EB"
```

Visually:

* Green arc grows with consistency
* Grey arc reminds you what you missed

---

# PART 5: ‚ÄúStreak at risk‚Äù warning (Duolingo nudge)

Duolingo nudges **before** failure.
We do the same.

A day is ‚Äúat risk‚Äù if:

* Fewer than 4 habits completed
* But at least 1 habit done

```dataview
LIST
FROM "Daily"
WHERE
  length(filter(file.tasks, (t) => t.completed)) > 0
  AND
  length(filter(file.tasks, (t) => t.completed)) < 4
SORT date DESC
LIMIT 1
```

If this list shows **today**, you are one habit away from saving your streak.

This is powerful.

---

# PART 6: Optional ‚Äî Streak Freeze (advanced, optional)

If you want Duolingo-style streak freezes:

Add to daily frontmatter **only when used**:

```yaml
streak_freeze: true
```

Then modify logic:

```dataview
length(filter(file.tasks, (t) => t.completed)) >= 4
OR
file.streak_freeze = true
```

This gives you **one grace day**.

---

## Psychological design notes (why this works)

* Binary success removes ambiguity
* Threshold avoids perfectionism
* Streak break is painful enough to matter
* Visual ring makes loss tangible
* ‚ÄúAt risk‚Äù warning saves streaks proactively

This is **behavior design**, not just tracking.

---

## What you now have

* Exact Duolingo-grade streak logic
* Current streak
* Longest streak
* Streak health visualization
* Loss-prevention nudge
* Optional streak freeze

All powered by:

* Plain text
* Transparent rules
* No lock-in

---

## Next refinements (pick one)

I can now:

* Add XP and levels
* Add reward milestones
* Create weekly ‚ÄúXP goal‚Äù logic
* Design a streak-celebration view
* Optimize performance for years of data

Tell me which layer you want next and we build it cleanly.
